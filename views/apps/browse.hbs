<div class="space-y-6">
  {{#if error}}
  <div class="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded relative" role="alert">
    <strong class="font-bold">Error:</strong>
    <span class="block sm:inline">{{error}}</span>
  </div>
  {{/if}}

  <div class="flex items-center justify-between">
    <h2 class="text-2xl font-bold text-gray-800">App Marketplace</h2>
    <div class="flex items-center space-x-2">
      <span class="text-sm text-gray-500">{{apps.length}} apps available</span>
    </div>
  </div>

  <div class="flex flex-col lg:flex-row gap-6">
    <!-- Sidebar Filters -->
    <div class="lg:w-64 space-y-4">
      <!-- Search -->
      <div class="bg-white rounded-lg shadow p-4">
        <label for="search" class="block text-sm font-medium text-gray-700 mb-2">Search</label>
        <input type="text" id="search" name="search" 
               class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
               placeholder="Search apps..." value="{{search}}">
      </div>

      <!-- Categories -->
      <div class="bg-white rounded-lg shadow p-4">
        <h3 class="text-sm font-medium text-gray-700 mb-3">Categories</h3>
        <div class="space-y-2">
          <a href="/apps/browse" class="block px-3 py-2 rounded-md text-sm {{#unless category}}bg-blue-100 text-blue-700{{/unless}} hover:bg-gray-100">
            All Apps
          </a>
          {{#each categories}}
          <a href="/apps/browse?category={{this}}" class="block px-3 py-2 rounded-md text-sm {{#if (eq this ../category)}}bg-blue-100 text-blue-700{{/if}} hover:bg-gray-100">
            {{this}}
          </a>
          {{/each}}
        </div>
      </div>

      <!-- Sort -->
      <div class="bg-white rounded-lg shadow p-4">
        <label for="sort" class="block text-sm font-medium text-gray-700 mb-2">Sort By</label>
        <select id="sort" name="sort" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
          <option value="name" {{#if (eq sort 'name')}}selected{{/if}}>Name</option>
          <option value="category" {{#if (eq sort 'category')}}selected{{/if}}>Category</option>
        </select>
      </div>
    </div>

    <!-- Main Content -->
    <div class="flex-1">
      {{#if apps.length}}
      <div class="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-6">
        {{#each apps}}
        {{> app-card this}}
        {{/each}}
      </div>
      {{else}}
      <div class="bg-white shadow-md rounded-lg p-8 text-center">
        <svg class="mx-auto h-12 w-12 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10" />
        </svg>
        <h3 class="mt-2 text-sm font-medium text-gray-900">No apps found</h3>
        <p class="mt-1 text-sm text-gray-500">
          {{#if search}}No apps match your search "{{search}}".{{/if}}
          {{#if category}}No apps found in the "{{category}}" category.{{/if}}
          {{#unless (or search category)}}No apps are currently available.{{/unless}}
        </p>
      </div>
      {{/if}}
    </div>
  </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
  const searchInput = document.getElementById('search');
  const sortSelect = document.getElementById('sort');
  
  if (searchInput) {
    searchInput.addEventListener('input', function(e) {
      const params = new URLSearchParams(window.location.search);
      if (e.target.value) {
        params.set('search', e.target.value);
      } else {
        params.delete('search');
      }
      window.location.search = params.toString();
    });
  }
  
  if (sortSelect) {
    sortSelect.addEventListener('change', function(e) {
      const params = new URLSearchParams(window.location.search);
      params.set('sort', e.target.value);
      window.location.search = params.toString();
    });
  }
});
</script>